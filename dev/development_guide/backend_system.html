
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Backend System &#8212; TensorLy: Tensor Learning in Python</title> 
<link rel="stylesheet" href="../_static/tensorly_style.css">
<link rel="apple-touch-icon" sizes="180x180" href="../_static/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../_static/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../_static/favicon/favicon-16x16.png">
<link rel="manifest" href="../_static/favicon/site.webmanifest">
<link rel="mask-icon" href="../_static/favicon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="../_static/favicon/favicon.ico">
<meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tensorly_style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />

  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
 <script src="../_static/navbar_burger.js"></script>
 <script defer src="https://use.fontawesome.com/releases/v5.14.0/js/all.js"></script>
 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3V91QCZR03"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3V91QCZR03');
</script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="About us" href="../about.html" />
    <link rel="prev" title="Writing documentation" href="documentation.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  </head>
<body  class="has-navbar-fixed-top">

  <header>
    <navbar>
      <nav class="navbar top-navbar is-fixed-top has-shadow is-flex-wrap-wrap" role="navigation" aria-label="main top navigation">
        <div class="navbar-brand">
        <!-- Always displayed, last item has to be navbar-burger -->

          <a class="navbar-item" href="../index.html">
            <img src="../_static/logo_tensorly.png" height="28">
          </a>

          <!-- <a class="navbar-item is-hidden-desktop" href="../index.html">
            <span class="icon"><i class="fa fa-home" aria-hidden="true"></i></span>
          </a> -->
          <a class="navbar-item is-hidden-desktop" href="https://github.com/tensorly/tensorly" target="_blank">
              <span class="icon"><i class="fab fa-github"></i></span>
          </a>

          <a role="button" class="navbar-burger" data-target="top-nav-menu" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>

        </div>
        
        <div class="navbar-menu" id="top-nav-menu">
        <!-- only on larger displays (> 1024px) -->

          <div class="navbar-start">
          <!-- RIGHT -->
            <a class="navbar-item" href="../installation.html">
              Install
            </a>
            <a class="navbar-item" href="../user_guide/index.html">
              User Guide
            </a>
            <a class="navbar-item" href="../modules/api.html">
              API
            </a>
            <a class="navbar-item" href="../auto_examples/index.html">
              Examples
            </a>
            <a class="navbar-item" href="../about.html">
              About Us
            </a>
            <a class="navbar-item" href="https://github.com/JeanKossaifi/tensorly-notebooks" target="_blank">
              Notebooks
            </a>

          </div>
        
          <div class="navbar-end">
            <div class="navbar-item">
            <!-- LEFT -->

            <!-- <a class="navbar-item is-hidden-touch" href="../index.html">
              <span class="icon-text">
                <span class="icon">
                  <i class="fa fa-home"></i>
                </span>
                <span>Home</span>
              </span>
              <span class="icon"><i class="fa fa-home" aria-hidden="true"></i></span>
            </a> -->
            <a class="button is-hidden-touch is-dark" href="https://github.com/tensorly/tensorly" target="_blank">
              <span class="icon-text">
                <span class="icon is-large">
                  <i class="fab fa-github"></i>
                </span>
                <span>Github</span>
              </span>
                <!-- <span class="icon"><i class="fab fa-github"></i></span> -->
            </a>

            </div> <!-- navbar item -->
          </div> <!-- navbar end -->
        </div> <!-- only large items -->

      </nav>
      
    </navbar>
  </header>

  <div id="column-container">
  <div class="columns is-mobile is-centered">
	
      <div class="column is-10-mobile is-one-third-tablet is-3-desktop is-hidden-mobile" id="sidebar">
    <!-- Side menu  -->
    <aside class="sticky-nav sidebar-menu">
<div class="sidebar-search">
  <form class="field" id="searchbox" role="search" action="../search.html" method="get">
    <!-- <label class="label" id="searchlabel">Quick search</label> -->
    <div class="field has-addons">
      <div class="control is-expanded">
        <input class="input" type="text" placeholder="Search in TensorLy" name="q" aria-labelledby="searchlabel">
      </div>
      <div class="control">
        <input class="button is-info" type="submit" value="Go" />
      </div>
    </div>
  </form>
  <script>$('#searchbox').show(0);</script>
  <script>
  $(document).ready(function() {
    Document.highlightSearchWords = function() {
      var params = $.getQueryParameters();
      var terms = (params.highlight) ? params.highlight[0].split(/\s+/) : [];
      if (terms.length) {
        var body = $('div.body');
        if (!body.length) {
          body = $('body');
        }
        window.setTimeout(function() {
          $.each(terms, function() {
            body.highlightText(this.toLowerCase(), 'highlighted');
          });
        }, 10);
        $('<p class="highlight-link"><a href="javascript:Documentation.' +
          'hideSearchWords()">' + _('Hide All')
          + '<span class="tag is-delete"></span>'
          + '</a></p>')
            .appendTo($('#searchbox'));
      }
    };
  });
  </script>
</div>
      
      <div class="sidebar-menu-toc">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing tensorly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Gallery of examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Development guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Writing documentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Backend System</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/JeanKossaifi/tensorly-notebooks">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About us</a></li>
</ul>
 
      </div>
    </aside>
  </div>
  

    <div class="column main-column">

      <!-- Main content  -->
      <section class="main-section">

        <!-- Toggle menu button -->
		
        <div class="side-menu-toggle">
          <button class="button" id="toggle-sidebar" onclick="toggle_sidebar()">
            <span class="icon"><i class="fa fa-bars" aria-hidden="true"></i></span>
            <span>menu</span> 
          </button>
        </div>
        

        <div class="content main-content">
          
  <section id="backend-system">
<span id="id1"></span><h1>Backend System</h1>
<p>The TensorLy backend system allows for switching between multiple backends in
a thread-local way.  You can obtain the back that is currently being used with the
<code class="docutils literal notranslate"><span class="pre">get_backend()</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tensorly</span> <span class="k">as</span> <span class="nn">tl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tl</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
<span class="go">&#39;numpy&#39;</span>
</pre></div>
</div>
<p>You may set the backend globally with the <code class="docutils literal notranslate"><span class="pre">set_backend()</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tl</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s1">&#39;tensorflow&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tl</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
<span class="go">&#39;tensorflow&#39;</span>
</pre></div>
</div>
<p>Setting the backend is local to the thread that <code class="docutils literal notranslate"><span class="pre">set_backend()</span></code> is
executed on. This enables third-party packages (e.g. Dask) to parallelize
operations over multiple backends, as needed. Threads inherit the backend
from the thread that spawned them (which is typically the main thread).
Globally setting the backend supports interactive usage.</p>
<p>Additionally,  we provide a context manager <code class="docutils literal notranslate"><span class="pre">backend_context</span></code>
for convenience, whcih may be used to
safely use a backend only for limited context:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">tl</span><span class="o">.</span><span class="n">backend_context</span><span class="p">(</span><span class="s1">&#39;pytorch&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
<p>This is also thread-safe. The context manager approach is useful in
third-party libraries that wish to ensure a particular backend is used,
no matter what the global backend is set to at the time the library code
is executed.</p>
<section id="how-the-backend-system-works">
<h2>How the Backend System Works</h2>
<section id="the-backend-class">
<h3>The Backend class</h3>
<p>A backend is represented as a class, which implements the various functions needed
(e.g. <cite>transpose</cite>, <cite>clip</cite>, etc).</p>
<p>A base class <code class="docutils literal notranslate"><span class="pre">tensorly.backend.core.Backend</span></code> is given in <cite>tensorly/backend/core.py</cite>,
which implement <code class="docutils literal notranslate"><span class="pre">staticmethods</span></code> of the common TensorLy API
(e.g. <code class="docutils literal notranslate"><span class="pre">tensor</span></code>, <code class="docutils literal notranslate"><span class="pre">fold</span></code>, <code class="docutils literal notranslate"><span class="pre">norm</span></code>, etc.).
It will also provide some useful functions by default (e.g. <cite>kron</cite>, <cite>kr</cite>, <cite>partial_svd</cite>).</p>
<p>This base class should be subclassed when defining a new backend.</p>
</section>
<section id="loading-a-backend">
<h3>Loading a backend</h3>
<p>The logic for loading is in <cite>tensorly/backend/__init__.py</cite>.
A cache of already loaded backend is maintained
as in a dictionary <code class="docutils literal notranslate"><span class="pre">_LOADED_BACKENDS</span></code>
(the keys of which are the backends’ names and the values the actual backend classes).</p>
<p>When a backend is set (by calling <code class="docutils literal notranslate"><span class="pre">tensorly.backend.set_backend</span></code>),
the backend specific module (called``tensorly.backend.{name}_backend``)
is loaded if the backend has not already been loaded and set as the current backend.</p>
<p>If the backend name is not in <code class="docutils literal notranslate"><span class="pre">_LOADED_BACKENDS</span></code>,
the corresponding backend module
(<code class="docutils literal notranslate"><span class="pre">tensorly.backend.{name}_backend</span></code>)
is dynamically imported
(via <code class="docutils literal notranslate"><span class="pre">importlib</span></code>) by the the <code class="docutils literal notranslate"><span class="pre">tensorly.backend.register_backend</span></code> function.</p>
<p>Once the backend is loaded, it is
grabbed from the internal cache (<code class="docutils literal notranslate"><span class="pre">tensorly.backend.core._LOADED_BACKENDS</span></code>)
and set as the current backend (<code class="docutils literal notranslate"><span class="pre">tensorly.backend.core._STATE.backend</span></code>).
Note that <code class="docutils literal notranslate"><span class="pre">tensorly.backend.core._STATE.backend</span></code> is a thread-local storage.</p>
</section>
<section id="backend-function-s-dispatching">
<h3>Backend function’s dispatching</h3>
<p>The TensorLy API functions are then dynamically farmed out to the backend
staticmethods via the dispatching mechanism provided by
<code class="docutils literal notranslate"><span class="pre">tensorly.backend.core.dispatch</span></code>. This ensure that the API function is
wrapped such that it has the correct docstring, name, function signature, and
other required minutia.</p>
<p>Additionally, the modules themselves are also wrapped such that certain
global (module-level) variables ar dynamically dispatched as well, like
<code class="docutils literal notranslate"><span class="pre">property</span></code> or other class descriptors. This is to ensure that variables
such as <code class="docutils literal notranslate"><span class="pre">int32</span></code> or <code class="docutils literal notranslate"><span class="pre">float64</span></code> point to the correct, backend-specific
object.  For example, numpy’s <code class="docutils literal notranslate"><span class="pre">np.int32</span></code> and tensorflow’s <code class="docutils literal notranslate"><span class="pre">tf.int32</span></code>
are not compatible.</p>
<p>The dynamic dispatch of these module-level varaibles
is implemented by the <code class="docutils literal notranslate"><span class="pre">tensorly.backend.override_module_dispatch</span></code>
function.
This is done in two ways:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>For Python &gt;= 3.7.0</strong>: using module’s _getattr__ and __dir__ as defined by</dt><dd><p><a class="reference external" href="https://www.python.org/dev/peps/pep-0562/">PEP 562</a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>For Python &lt; 3.7.0</strong>: by overwriting</dt><dd><p>sys.modules[module_name].__class__ with a custom class,
subclassing <code class="docutils literal notranslate"><span class="pre">types.ModuleType</span></code> for which we have overrridden the
<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> and <code class="docutils literal notranslate"><span class="pre">__dir__</span></code> methods.</p>
</dd>
</dl>
</li>
</ul>
</section>
</section>
</section>


        </div>

		
        <nav class="pagination" role="navigation" aria-label="pagination">
    
    <a class="button is-medium pagination-previous" href="documentation.html" title="previous page" accesskey="p">
        <span class="icon">
            <i class="fa fa-arrow-circle-left"></i>
        </span>
        <span>Writing documentation</span>
    </a>
    
    
    <a class="button is-medium pagination-next" href="../about.html" title="next page" accesskey="n">
        <span>About us </span>
        <span class="icon">
            <i class="fa fa-arrow-circle-right"></i>
        </span>
    </a>
    
</nav>

        

      </section>

        <footer class="footer">
    <div class="content has-text-centered">
        <div class="block">
          &copy; Copyright 2016 - 2021, TensorLy Developers.<br/>
        </div>
    </div>
  </footer>

    </div>

	
    
    <div class="column is-hidden-touch is-2-desktop is-one-fifth-widescreen" id="localtoc-column">

    <aside class="sticky-nav localtoc">  
        <div class="menu menu-list">
        <p class="menu-label">On this page</p>
        <ul>
<li><a class="reference internal" href="#">Backend System</a><ul>
<li><a class="reference internal" href="#how-the-backend-system-works">How the Backend System Works</a><ul>
<li><a class="reference internal" href="#the-backend-class">The Backend class</a></li>
<li><a class="reference internal" href="#loading-a-backend">Loading a backend</a></li>
<li><a class="reference internal" href="#backend-function-s-dispatching">Backend function’s dispatching</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    </aside>
    </div>

    

  </div>
  </div>

  <!-- Include here scripts that need to be added after the page is loaded -->
  <script>
    function toggle_sidebar() {
        var element = document.getElementById("sidebar");
        var container = document.getElementById("column-container");
        var localtoccolumn = document.getElementById("localtoc-column");
        element.classList.toggle("hide-tablet");
        element.classList.toggle("is-hidden-mobile");
        container.classList.toggle("sidemenu-hidden");
        localtoccolumn.classList.toggle("is-one-fifth-widescreen");
        localtoccolumn.classList.toggle("is-2-desktop");
        localtoccolumn.classList.toggle("is-3-desktop");
    }
  </script> 



  </body>
</html>